<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Price List Generator - Professional Catalogs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom blue theme */
        .bg-primary { background-color: #2563eb; }
        .bg-primary-dark { background-color: #1d4ed8; }
        .text-primary { color: #2563eb; }
        .border-primary { border-color: #2563eb; }

```
    /* Custom gradients */
    .gradient-header {
        background: linear-gradient(135deg, #2563eb 0%, #1e40af 50%, #1e3a8a 100%);
    }
    
    /* Product grid styling */
    .product-card {
        transition: all 0.2s ease;
        border: 2px solid transparent;
    }
    
    .product-card:hover {
        border-color: #2563eb;
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(37, 99, 235, 0.15);
    }
    
    .product-card.selected {
        border-color: #2563eb;
        background-color: #eff6ff;
    }
    
    /* Collection tabs */
    .collection-tab {
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .collection-tab.active {
        background-color: #2563eb;
        color: white;
    }
    
    .collection-tab:not(.active):hover {
        background-color: #e5e7eb;
    }
</style>
```

</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-header text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <span class="text-2xl mr-3">üìÑ</span>
                    <h1 class="text-2xl font-bold">Price List Generator</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="storeInfo" class="text-blue-100"></span>
                    <button id="exportBtn" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-all">
                        üì• Export PDF
                    </button>
                </div>
            </div>
        </div>
    </header>

```
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="grid lg:grid-cols-3 gap-8">
        
        <!-- Left Column: Company Branding & Settings -->
        <div class="lg:col-span-1 space-y-6">
            
            <!-- Company Information -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                    üè¢ Company Information
                </h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Company Name</label>
                        <input type="text" id="companyName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Your Company Name">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Contact Email</label>
                        <input type="email" id="companyEmail" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="contact@company.com">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                        <input type="tel" id="companyPhone" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="+1 (555) 123-4567">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Company Logo</label>
                        <input type="file" id="logoUpload" accept="image/*" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <div id="logoPreview" class="mt-2 hidden">
                            <img id="logoImage" src="" alt="Logo Preview" class="max-w-full h-20 object-contain">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Price List Settings -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                    ‚öôÔ∏è Price List Settings
                </h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">List Title</label>
                        <input type="text" id="listTitle" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="2025 Product Catalog" value="2025 Product Catalog">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Currency</label>
                        <select id="currency" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="USD">USD ($)</option>
                            <option value="EUR">EUR (‚Ç¨)</option>
                            <option value="GBP">GBP (¬£)</option>
                            <option value="CAD">CAD ($)</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Default Markup %</label>
                        <input type="number" id="defaultMarkup" min="0" max="500" value="20" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Terms & Conditions</label>
                        <textarea id="terms" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Payment terms: Net 30 days. Prices valid for 30 days.">Payment terms: Net 30 days. Prices valid for 30 days.</textarea>
                    </div>
                </div>
            </div>

            <!-- Selected Products Summary -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                    üìä Selected Products
                </h2>
                <div class="text-center text-gray-500">
                    <span id="selectedCount" class="text-2xl font-bold text-primary">0</span>
                    <p class="text-sm">products selected</p>
                </div>
                <button id="clearSelection" class="w-full mt-4 bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-4 rounded-lg transition-colors">
                    Clear Selection
                </button>
            </div>
        </div>

        <!-- Right Column: Product Selection -->
        <div class="lg:col-span-2">
            <div class="bg-white rounded-lg shadow-md">
                
                <!-- Product Selection Header -->
                <div class="p-6 border-b border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                        üõçÔ∏è Select Products from Your Store
                    </h2>
                    
                    <!-- Search and Filters -->
                    <div class="flex flex-col md:flex-row gap-4 mb-4">
                        <div class="flex-1">
                            <input type="text" id="productSearch" placeholder="Search products..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <button id="loadProducts" class="bg-primary hover:bg-primary-dark text-white px-6 py-3 rounded-lg transition-colors">
                            üîÑ Load Products
                        </button>
                    </div>
                    
                    <!-- Collection Tabs -->
                    <div id="collectionTabs" class="flex flex-wrap gap-2">
                        <span class="collection-tab active" data-collection="all">All Products</span>
                        <span class="collection-tab" data-collection="featured">Featured</span>
                        <span class="collection-tab" data-collection="electronics">Electronics</span>
                        <span class="collection-tab" data-collection="accessories">Accessories</span>
                    </div>
                </div>
                
                <!-- Product Grid -->
                <div class="p-6">
                    <div id="productGrid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
                        <!-- Loading state -->
                        <div class="col-span-full text-center py-12">
                            <div class="text-6xl mb-4">üì¶</div>
                            <p class="text-gray-500 mb-4">Click "Load Products" to browse your Shopify products</p>
                            <p class="text-sm text-gray-400">Select products to include in your price list</p>
                        </div>
                    </div>
                    
                    <!-- Load More Button -->
                    <div id="loadMoreContainer" class="text-center mt-6 hidden">
                        <button id="loadMore" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-6 py-3 rounded-lg transition-colors">
                            Load More Products
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Export Modal -->
<div id="exportModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg p-8 max-w-md mx-4 w-full">
        <h3 class="text-xl font-semibold mb-4">Export Price List</h3>
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Export Format</label>
                <select id="exportFormat" class="w-full p-3 border border-gray-300 rounded-lg">
                    <option value="pdf">PDF (Professional)</option>
                    <option value="csv">CSV (Spreadsheet)</option>
                    <option value="json">JSON (Data)</option>
                </select>
            </div>
            <div class="flex gap-3 pt-4">
                <button id="cancelExport" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 rounded-lg transition-colors">
                    Cancel
                </button>
                <button id="confirmExport" class="flex-1 bg-primary hover:bg-primary-dark text-white py-3 rounded-lg transition-colors">
                    Export
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Loading Modal -->
<div id="loadingModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 max-w-sm mx-4">
        <div class="flex items-center">
            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mr-3"></div>
            <span class="text-gray-900" id="loadingText">Loading products...</span>
        </div>
    </div>
</div>

<script>
    // Application State
    const state = {
        products: [],
        selectedProducts: new Set(),
        currentCollection: 'all',
        isLoading: false,
        currentPage: 1,
        hasMore: true
    };

    // DOM Elements
    const elements = {
        productGrid: document.getElementById('productGrid'),
        selectedCount: document.getElementById('selectedCount'),
        productSearch: document.getElementById('productSearch'),
        loadProducts: document.getElementById('loadProducts'),
        collectionTabs: document.querySelectorAll('.collection-tab'),
        exportBtn: document.getElementById('exportBtn'),
        exportModal: document.getElementById('exportModal'),
        loadingModal: document.getElementById('loadingModal'),
        clearSelection: document.getElementById('clearSelection'),
        logoUpload: document.getElementById('logoUpload'),
        logoPreview: document.getElementById('logoPreview'),
        logoImage: document.getElementById('logoImage')
    };

    // Product Selection Functions
    function toggleProductSelection(productId) {
        if (state.selectedProducts.has(productId)) {
            state.selectedProducts.delete(productId);
        } else {
            state.selectedProducts.add(productId);
        }
        updateSelectedCount();
        updateProductDisplay();
    }

    function updateSelectedCount() {
        elements.selectedCount.textContent = state.selectedProducts.size;
    }

    function updateProductDisplay() {
        document.querySelectorAll('.product-card').forEach(card => {
            const productId = card.dataset.productId;
            if (state.selectedProducts.has(productId)) {
                card.classList.add('selected');
            } else {
                card.classList.remove('selected');
            }
        });
    }

    function createProductCard(product) {
        const isSelected = state.selectedProducts.has(product.id);
        const price = parseFloat(product.variants?.[0]?.price || product.price || 0);
        const formattedPrice = new Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: 'USD'
        }).format(price);

        return `
            <div class="product-card bg-white border rounded-lg p-4 cursor-pointer ${isSelected ? 'selected' : ''}" 
                 data-product-id="${product.id}" onclick="toggleProductSelection('${product.id}')">
                
                ${product.image ? `
                    <img src="${product.image.src || product.image}" alt="${product.title}" 
                         class="w-full h-32 object-cover rounded-lg mb-3">
                ` : `
                    <div class="w-full h-32 bg-gray-100 rounded-lg mb-3 flex items-center justify-center">
                        <span class="text-3xl">üì¶</span>
                    </div>
                `}
                
                <h3 class="font-medium text-gray-900 mb-1 line-clamp-2">${product.title}</h3>
                <p class="text-sm text-gray-500 mb-2">${product.vendor || 'No vendor'}</p>
                <div class="flex justify-between items-center">
                    <span class="text-lg font-semibold text-primary">${formattedPrice}</span>
                    <div class="flex items-center">
                        ${isSelected ? 
                            '<span class="text-primary text-xl">‚úì</span>' : 
                            '<span class="text-gray-300 text-xl">‚óã</span>'
                        }
                    </div>
                </div>
                
                ${product.variants && product.variants.length > 1 ? `
                    <p class="text-xs text-gray-400 mt-1">${product.variants.length} variants</p>
                ` : ''}
            </div>
        `;
    }

    // Load Products from Shopify
    async function loadProducts(reset = false) {
        if (state.isLoading) return;
        
        state.isLoading = true;
        showLoading('Loading products...');
        
        try {
            const page = reset ? 1 : state.currentPage;
            const response = await fetch(`/api/products?page=${page}&collection=${state.currentCollection}&search=${elements.productSearch.value}`);
            
            if (!response.ok) throw new Error('Failed to load products');
            
            const data = await response.json();
            
            if (reset) {
                state.products = data.products || data;
                elements.productGrid.innerHTML = '';
            } else {
                state.products = [...state.products, ...(data.products || data)];
            }
            
            renderProducts(data.products || data);
            
            // Update pagination
            state.currentPage = page + 1;
            state.hasMore = (data.products || data).length > 0;
            
            // Show/hide load more button
            const loadMoreContainer = document.getElementById('loadMoreContainer');
            if (state.hasMore && state.products.length > 0) {
                loadMoreContainer.classList.remove('hidden');
            } else {
                loadMoreContainer.classList.add('hidden');
            }
            
        } catch (error) {
            console.error('Error loading products:', error);
            elements.productGrid.innerHTML = `
                <div class="col-span-full text-center py-12">
                    <div class="text-6xl mb-4">‚ö†Ô∏è</div>
                    <p class="text-red-500 mb-2">Failed to load products</p>
                    <p class="text-sm text-gray-500">${error.message}</p>
                    <button onclick="loadProducts(true)" class="mt-4 bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded-lg">
                        Try Again
                    </button>
                </div>
            `;
        } finally {
            state.isLoading = false;
            hideLoading();
        }
    }

    function renderProducts(products) {
        if (!products || products.length === 0) {
            if (state.products.length === 0) {
                elements.productGrid.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="text-6xl mb-4">üì≠</div>
                        <p class="text-gray-500">No products found</p>
                        <p class="text-sm text-gray-400">Try adjusting your search or collection filter</p>
                    </div>
                `;
            }
            return;
        }

        const newProductsHTML = products.map(createProductCard).join('');
        elements.productGrid.insertAdjacentHTML('beforeend', newProductsHTML);
        updateProductDisplay();
    }

    // Collection Filtering
    function switchCollection(collection) {
        state.currentCollection = collection;
        state.currentPage = 1;
        
        // Update active tab
        elements.collectionTabs.forEach(tab => {
            tab.classList.remove('active');
            if (tab.dataset.collection === collection) {
                tab.classList.add('active');
            }
        });
        
        loadProducts(true);
    }

    // Utility Functions
    function showLoading(text = 'Loading...') {
        document.getElementById('loadingText').textContent = text;
        elements.loadingModal.classList.remove('hidden');
        elements.loadingModal.classList.add('flex');
    }

    function hideLoading() {
        elements.loadingModal.classList.add('hidden');
        elements.loadingModal.classList.remove('flex');
    }

    function showExportModal() {
        if (state.selectedProducts.size === 0) {
            alert('Please select at least one product before exporting.');
            return;
        }
        elements.exportModal.classList.remove('hidden');
        elements.exportModal.classList.add('flex');
    }

    function hideExportModal() {
        elements.exportModal.classList.add('hidden');
        elements.exportModal.classList.remove('flex');
    }

    // Export Functionality
    async function exportPriceList() {
        const format = document.getElementById('exportFormat').value;
        const selectedProductsData = state.products.filter(p => state.selectedProducts.has(p.id));
        
        showLoading('Generating export...');
        hideExportModal();
        
        try {
            const exportData = {
                company: {
                    name: document.getElementById('companyName').value,
                    email: document.getElementById('companyEmail').value,
                    phone: document.getElementById('companyPhone').value
                },
                settings: {
                    title: document.getElementById('listTitle').value,
                    currency: document.getElementById('currency').value,
                    markup: document.getElementById('defaultMarkup').value,
                    terms: document.getElementById('terms').value
                },
                products: selectedProductsData,
                format: format
            };
            
            const response = await fetch('/api/export', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(exportData)
            });
            
            if (!response.ok) throw new Error('Export failed');
            
            // Handle different export formats
            if (format === 'pdf') {
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `price-list-${new Date().toISOString().split('T')[0]}.pdf`;
                a.click();
                window.URL.revokeObjectURL(url);
            } else {
                const data = await response.json();
                console.log('Export successful:', data);
            }
            
        } catch (error) {
            console.error('Export error:', error);
            alert('Export failed. Please try again.');
        } finally {
            hideLoading();
        }
    }

    // Logo Upload Handling
    function handleLogoUpload(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                elements.logoImage.src = e.target.result;
                elements.logoPreview.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }
    }

    // Event Listeners
    elements.loadProducts.addEventListener('click', () => loadProducts(true));
    elements.productSearch.addEventListener('input', debounce(() => loadProducts(true), 500));
    elements.exportBtn.addEventListener('click', showExportModal);
    elements.clearSelection.addEventListener('click', () => {
        state.selectedProducts.clear();
        updateSelectedCount();
        updateProductDisplay();
    });

    document.getElementById('loadMore').addEventListener('click', () => loadProducts(false));
    document.getElementById('cancelExport').addEventListener('click', hideExportModal);
    document.getElementById('confirmExport').addEventListener('click', exportPriceList);
    elements.logoUpload.addEventListener('change', handleLogoUpload);

    // Collection tab listeners
    elements.collectionTabs.forEach(tab => {
        tab.addEventListener('click', () => switchCollection(tab.dataset.collection));
    });

    // Debounce utility
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }

    // Initialize
    console.log('üöÄ Price List Generator initialized');
    console.log('üëÜ Click "Load Products" to get started');
</script>
```

</body>
</html>